{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the ShopNGo application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "User's role (Customer, Admin, Delivery)."
        },
        "address": {
          "type": "string",
          "description": "User's address."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for purchase.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "stock": {
          "type": "number",
          "description": "Number of units currently in stock."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product's image.",
          "format": "uri"
        },
        "features": {
          "type": "array",
          "description": "Array of product features",
          "items": {
            "type": "string"
          }
        },
        "materials": {
          "type": "array",
          "description": "Array of materials or ingredients of product",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "categoryId",
        "description",
        "price",
        "stock",
        "imageUrl"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "productIds": {
          "type": "array",
          "description": "References to Products. (Relationship: Order 1:N Product)",
          "items": {
            "type": "string"
          }
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "Current status of the order."
        },
        "paymentStatus": {
          "type": "string",
          "description": "Payment status of the order."
        },
        "deliveryAddress": {
          "type": "string",
          "description": "Delivery address for the order."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the order was placed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "productIds",
        "totalAmount",
        "status",
        "paymentStatus",
        "deliveryAddress",
        "timestamp"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a user review for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user for the product."
        },
        "comment": {
          "type": "string",
          "description": "User's comment on the product."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "productId",
        "rating",
        "comment",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' is part of the path, enabling simple ownership-based security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores product categories.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders associated with a specific user. The path-based ownership `/users/{userId}` automatically secures the orders to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews for products. This benefits from implicit filtering via the product ID in the path. Review data contains the userId which facilitates display of the user name.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier for the review."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the e-commerce application 'ShopNGo', emphasizing security, scalability, and ease of debugging. It adheres to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization of authorization data (e.g., user roles, membership maps) directly within documents or subcollections where access control is required. This eliminates the need for `get()` calls in security rules, ensuring atomic operations and simplifying debugging. Structural Segregation is applied by keeping data with differing access requirements in separate collections. Access Modeling uses path-based ownership for user-specific data (e.g., orders) and membership maps for collaborative entities (though not explicitly used in this design based on the provided entities but kept as a potential pattern). Explicit State Modeling uses a `status` field for order management. The design avoids dynamic keys and enforces consistent naming conventions for fields and wildcards.\n\nSpecifically:\n\n*   `/users/{userId}`: Stores user profiles. User ID is part of the path, enabling simple ownership-based rules. No denormalization needed as other collections reference this path.\n*   `/products/{productId}`: Stores product information. No specific authorization concerns are managed here beyond general read access, or write access restricted to specific roles (e.g., admin).\n*   `/categories/{categoryId}`: Stores product categories. Similar to products, authorization is simple and likely based on roles.\n*   `/users/{userId}/orders/{orderId}`: Stores orders associated with a specific user. The path-based ownership `/users/{userId}` automatically secures the orders to the user. Includes denormalized data from Products.\n*   `/products/{productId}/reviews/{reviewId}`: Stores reviews for products. This benefits from implicit filtering via the product ID in the path.  Review data contains the userId which facilitates display of the user name."
  }
}
